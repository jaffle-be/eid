(function(e,t,n){var r=null,i=new t.maps.InfoWindow,s={markers:[],searchNearMe:function(){var e=this;this.addMyMarker(function(t){e.getLocations({near:t,callback:function(t){e.clearMarkers();e.setCenter(t.center,t.bounds);e.setLocations(t.locations)}})})},setCenter:function(e,n){var e=new t.maps.LatLng(e.latitude,e.longitude);r.setCenter(e);var i=new t.maps.LatLng(n.minLat,n.minLong),s=new t.maps.LatLng(n.maxLat,n.maxLong);r.fitBounds(new t.maps.LatLngBounds(i,s))},getMarker:function(e){var n=new t.maps.Marker;n.setPosition(new t.maps.LatLng(e.Latitude,e.Longitude));t.maps.event.addListener(n,"mouseover",function(){i.setPosition(new t.maps.LatLng(e.lat,e.long));i.setContent("<h4><b>"+e.OrganisationName+"</b></h4>"+"<p>"+e.Street+" "+e.NrAndBox+"<br/>"+e.ZipCode+" "+e.Village+"</p>");i.open(r,n)});return n},addMyMarker:function(e){this.geolocation()&&n.navigator.geolocation.getCurrentPosition(function(n){var i=new t.maps.Marker({position:new t.maps.LatLng(n.coords.latitude,n.coords.longitude),icon:"http://maps.google.com/mapfiles/ms/micons/green.png"});i.setMap(r);typeof e=="function"&&e(n.coords)})},geolocation:function(){return e("html").hasClass("geolocation")},getLocations:function(t){if(typeof t.callback=="function"){callback=t.callback;delete t.callback}that=this;e.ajax({url:"/api/application",data:t,type:"GET",dataType:"json",success:function(e){callback&&typeof callback=="function"&&callback.call(that,e)}})},setLocations:function(e){for(var t in e){marker=this.getMarker(e[t]);marker.setMap(r);s.markers.push(marker)}},clearMarkers:function(){for(var e in this.markers)this.markers[e].setMap(null);this.markers=[]},init:function(){s.getLocations({callback:function(e){var n={zoom:8};r=new t.maps.Map(document.getElementById("map-canvas"),n);s.setCenter(e.center,e.bounds);s.setLocations(e.locations)}})}};e(document).ready(function(){s.init();e(".my-location").on("click",function(e){s.searchNearMe();e.preventDefault()})})})(window.jQuery,window.google,window);